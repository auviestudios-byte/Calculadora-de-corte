<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculadora de Corte - Renacer Deco</title>

<style>
body{
    font-family: Arial, sans-serif;
    background:#f4f4f4;
    margin:0;
    padding:10px;
}
.logo-container{
    background:white;
    text-align:center;
    padding:10px;
    border-radius:8px;
    margin-bottom:10px;
}
.logo-container img{max-width:180px;}
.subtitle{font-size:14px;font-weight:bold;margin-top:6px;}

.section{
    background:white;
    padding:12px;
    border-radius:8px;
    margin-bottom:10px;
}
.input-group{
    display:flex;
    align-items:center;
    margin-bottom:8px;
}
label{width:90px;font-size:14px;}
input,select{flex:1;padding:8px;font-size:16px;}

.buttons{
    display:flex;
    gap:10px;
    margin:10px 0;
}
button{
    flex:1;
    padding:12px;
    font-size:16px;
    font-weight:bold;
    border:none;
    border-radius:6px;
    cursor:pointer;
}
.btn-calc{background:#4CAF50;color:white;}
.btn-down{background:#2196F3;color:white;}

#info{text-align:center;font-weight:bold;margin-bottom:10px;}

.canvas-container{
    background:white;
    border-radius:8px;
    padding:5px;
    overflow-x:auto;
}
canvas{
    border:1px solid #000;
    max-width:100%;
    height:auto;
    display:block;
    margin:0 auto;
}
</style>
</head>

<body>

<div class="logo-container">
    <img id="logoImg" src="https://i.postimg.cc/1tyVJjwy/Logo_Blanco_violeta.png" crossorigin="anonymous">
    <div class="subtitle">Calculadora de corte para melamina</div>
</div>

<div class="section">
    <div class="input-group">
        <label>Unidad</label>
        <select id="unit">
            <option value="1">mm</option>
            <option value="10" selected>cm</option>
            <option value="1000">m</option>
        </select>
    </div>
</div>

<div class="section">
    <b>Tabla base</b>
    <div class="input-group"><label>Ancho</label><input id="bw" type="number"></div>
    <div class="input-group"><label>Alto</label><input id="bh" type="number"></div>
</div>

<div class="section">
    <b>Piezas a cortar</b>
    <div class="input-group"><label>Ancho</label><input id="cw" type="number"></div>
    <div class="input-group"><label>Alto</label><input id="ch" type="number"></div>
    <div class="input-group"><label>Cantidad</label><input id="qty" type="number"></div>
</div>

<div class="section">
    <b>Disco / Sierra</b>
    <div class="input-group"><label>Grosor mm</label><input id="kerf" type="number" value="0"></div>
</div>

<div class="buttons">
    <button class="btn-calc" onclick="draw()">Calcular</button>
    <button class="btn-down" onclick="download()">Descargar</button>
</div>

<div id="info"></div>

<div class="canvas-container">
    <canvas id="cv" width="1100" height="750"></canvas>
</div>

<script>
function v(id){
    let n=parseFloat(document.getElementById(id).value);
    return isNaN(n)?0:n;
}

let lastCanvas=null;

function draw(){
    const unit=parseFloat(unitEl.value);
    const bw=v("bw")*unit;
    const bh=v("bh")*unit;
    const cw=v("cw")*unit;
    const ch=v("ch")*unit;
    const qty=Math.floor(v("qty"));
    const kerf=v("kerf");

    if(bw<=0||bh<=0||cw<=0||ch<=0||qty<=0){
        alert("Completa todos los datos");
        return;
    }

    const c=cv;
    const ctx=c.getContext("2d");

    ctx.clearRect(0,0,c.width,c.height);
    ctx.fillStyle="white";
    ctx.fillRect(0,0,c.width,c.height);

    // MÁRGENES (dejan espacio al logo)
    const marginX=140;
    const marginY=140;

    const scale=Math.min(
        (c.width-marginX*2)/bw,
        (c.height-marginY*2)/bh
    );

    const ox=marginX;
    const oy=marginY;

    // TABLERO
    ctx.strokeStyle="blue";
    ctx.lineWidth=2;
    ctx.strokeRect(ox,oy,bw*scale,bh*scale);

    ctx.fillStyle="blue";
    ctx.font="15px Arial";
    ctx.fillText(`Tablero ${v("bw")} x ${v("bh")}`,ox,oy-25);

    // PIEZAS
    let x=0,y=0,rest=qty;
    ctx.strokeStyle="green";
    ctx.fillStyle="green";
    ctx.lineWidth=1;
    ctx.font="12px Arial";

    while(rest>0){
        if(x+cw>bw){x=0;y+=ch+kerf;}
        if(y+ch>bh)break;

        const dx=ox+x*scale;
        const dy=oy+y*scale;
        const pw=cw*scale;
        const ph=ch*scale;

        ctx.strokeRect(dx,dy,pw,ph);

        // ancho
        ctx.fillText(v("cw"),dx+pw/2-8,dy+ph+14);

        // alto
        ctx.save();
        ctx.translate(dx-10,dy+ph/2+8);
        ctx.rotate(-Math.PI/2);
        ctx.fillText(v("ch"),0,0);
        ctx.restore();

        x+=cw+kerf;
        rest--;
    }

    info.innerText="Cálculo listo para impresión";
    lastCanvas=c;
}

function download(){
    if(!lastCanvas){
        alert("Primero calcula");
        return;
    }

    const logo=document.getElementById("logoImg");

    if(!logo.complete){
        logo.onload=download;
        return;
    }

    const f=document.createElement("canvas");
    f.width=lastCanvas.width;
    f.height=lastCanvas.height;
    const ctx=f.getContext("2d");

    ctx.fillStyle="white";
    ctx.fillRect(0,0,f.width,f.height);

    // 1️⃣ DIBUJA EL PLANO
    ctx.drawImage(lastCanvas,0,0);

    // 2️⃣ DIBUJA EL LOGO ARRIBA (NO SE TAPA)
    ctx.drawImage(logo,20,20,160,55);

    const a=document.createElement("a");
    a.download="corte_melamina.png";
    a.href=f.toDataURL("image/png");
    a.click();
}

const unitEl=document.getElementById("unit");
</script>

</body>
</html>
