<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Calculadora de Corte - Renacer Deco</title>

<style>
body{
    font-family: Arial, sans-serif;
    background:#f4f4f4;
    margin:0;
    padding:10px;
}
.logo-container{
    background:white;
    text-align:center;
    padding:10px;
    border-radius:8px;
    margin-bottom:10px;
}
.logo-container img{max-width:180px;}
.subtitle{font-size:14px;font-weight:bold;margin-top:6px;}

.section{
    background:white;
    padding:12px;
    border-radius:8px;
    margin-bottom:10px;
}
.input-group{
    display:flex;
    align-items:center;
    margin-bottom:8px;
}
label{width:90px;font-size:14px;}
input,select{flex:1;padding:8px;font-size:16px;}

.buttons{
    display:flex;
    gap:10px;
    margin:10px 0;
}
button{
    flex:1;
    padding:12px;
    font-size:16px;
    font-weight:bold;
    border:none;
    border-radius:6px;
    cursor:pointer;
}
.btn-calc{background:#4CAF50;color:white;}
.btn-down{background:#2196F3;color:white;}

#info{text-align:center;font-weight:bold;margin-bottom:10px;}

.canvas-container{
    background:white;
    border-radius:8px;
    padding:5px;
    overflow-x:auto;
}
canvas{
    border:1px solid #000;
    max-width:100%;
    height:auto;
    display:block;
    margin:0 auto;
}
</style>
</head>

<body>

<div class="logo-container">
    <img id="logoImg" src="https://i.postimg.cc/1tyVJjwy/Logo_Blanco_violeta.png" crossorigin="anonymous">
    <div class="subtitle">Calculadora de corte para melamina</div>
</div>

<div class="section">
    <div class="input-group">
        <label>Unidad</label>
        <select id="unit">
            <option value="1">mm</option>
            <option value="10" selected>cm</option>
            <option value="1000">m</option>
        </select>
    </div>
</div>

<div class="section">
    <b>Tabla base</b>
    <div class="input-group"><label>Ancho</label><input id="bw" type="number"></div>
    <div class="input-group"><label>Alto</label><input id="bh" type="number"></div>
</div>

<div class="section">
    <b>Piezas a cortar</b>
    <div id="items">
        <div class="item">
            <div class="input-group"><label>Ancho</label><input class="cw" type="number"></div>
            <div class="input-group"><label>Alto</label><input class="ch" type="number"></div>
            <div class="input-group"><label>Cantidad</label><input class="qty" type="number"></div>
        </div>
    </div>
    <button onclick="addItem()">+</button>
</div>

<div class="section">
    <b>Disco / Sierra</b>
    <div class="input-group"><label>Grosor mm</label><input id="kerf" type="number" value="0"></div>
</div>

<div class="buttons">
    <button class="btn-calc" onclick="draw()">Calcular</button>
    <button class="btn-down" onclick="download()">Descargar</button>
</div>

<div id="info"></div>

<div class="canvas-container">
    <canvas id="cv" width="1100" height="750"></canvas>
</div>

<script>
function vEl(el){
    let n=parseFloat(el.value);
    return isNaN(n)?0:n;
}

function addItem(){
    const base=document.querySelector(".item");
    const clone=base.cloneNode(true);
    clone.querySelectorAll("input").forEach(i=>i.value="");
    document.getElementById("items").appendChild(clone);
}

let lastCanvas=null;

function draw(){
    const unit=parseFloat(unitEl.value);
    const bw=vEl(bwEl)*unit;
    const bh=vEl(bhEl)*unit;
    const kerf=vEl(kerfEl);

    const items=[...document.querySelectorAll(".item")].map(it=>{
        return {
            w:vEl(it.querySelector(".cw"))*unit,
            h:vEl(it.querySelector(".ch"))*unit,
            q:Math.floor(vEl(it.querySelector(".qty"))),
            lw:vEl(it.querySelector(".cw")),
            lh:vEl(it.querySelector(".ch"))
        };
    });

    const c=cv;
    const ctx=c.getContext("2d");
    ctx.clearRect(0,0,c.width,c.height);
    ctx.fillStyle="white";
    ctx.fillRect(0,0,c.width,c.height);

    const marginX=140;
    const marginY=140;

    const scale=Math.min(
        (c.width-marginX*2)/bw,
        (c.height-marginY*2)/bh
    );

    const ox=marginX;
    const oy=marginY;

    ctx.strokeStyle="blue";
    ctx.lineWidth=2;
    ctx.strokeRect(ox,oy,bw*scale,bh*scale);

    ctx.fillStyle="blue";
    ctx.font="15px Arial";
    ctx.fillText(`Tablero ${bw/unit} x ${bh/unit}`,ox,oy-25);

    let x=0,y=0;
    ctx.strokeStyle="green";
    ctx.fillStyle="green";
    ctx.font="12px Arial";

    items.forEach(item=>{
        let rest=item.q;
        while(rest>0){
            if(x+item.w>bw){x=0;y+=item.h+kerf;}
            if(y+item.h>bh)break;

            const dx=ox+x*scale;
            const dy=oy+y*scale;
            const pw=item.w*scale;
            const ph=item.h*scale;

            ctx.strokeRect(dx,dy,pw,ph);
            ctx.fillText(item.lw,dx+pw/2-8,dy+ph+14);

            ctx.save();
            ctx.translate(dx-10,dy+ph/2+8);
            ctx.rotate(-Math.PI/2);
            ctx.fillText(item.lh,0,0);
            ctx.restore();

            x+=item.w+kerf;
            rest--;
        }
    });

    info.innerText="Cálculo listo para impresión";
    lastCanvas=c;
}

function download(){
    if(!lastCanvas)return;
    const logo=logoImg;
    if(!logo.complete){logo.onload=download;return;}
    const f=document.createElement("canvas");
    f.width=lastCanvas.width;
    f.height=lastCanvas.height;
    const ctx=f.getContext("2d");
    ctx.fillStyle="white";
    ctx.fillRect(0,0,f.width,f.height);
    ctx.drawImage(lastCanvas,0,0);
    ctx.drawImage(logo,20,20,160,55);
    const a=document.createElement("a");
    a.download="corte_melamina.png";
    a.href=f.toDataURL("image/png");
    a.click();
}

const unitEl=document.getElementById("unit");
const bwEl=document.getElementById("bw");
const bhEl=document.getElementById("bh");
const kerfEl=document.getElementById("kerf");
</script>

</body>
</html>
